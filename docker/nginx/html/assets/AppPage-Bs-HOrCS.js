import{u as F,_ as U,q as b,i as N,e as i,c as r,b as l,j as O,r as D,o as V,a as I,k as p,C as y,F as x,h as w,w as h,v,n as T,M as z,d as E,t as u,x as B}from"./index-DNkYr-Dp.js";import{a as A}from"./app-BmTou4JB.js";import{c as X}from"./category-D9zZmuIX.js";const j=F(),R={data(){return{selectedFile:null,loading:!1}},methods:{handleFileChange(s){const e=s.target.files[0];this.beforeUpload(e)?this.selectedFile=e:this.selectedFile=null},beforeUpload(s){return s.type==="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"?!0:(b.message("请上传正确的 Excel (.xlsx) 文件","danger"),!1)},uploadFile(){if(!this.selectedFile)return;this.loading=!0;const s=new FormData;s.append("file",this.selectedFile),N.put("/user/apps/upload/xlsx",s,{headers:{"Content-Type":"multipart/form-data",Authorization:j.token.token}}).then(e=>{this.handleSuccess(e.data)}).catch(e=>{this.handleError(e)}).finally(()=>{this.loading=!1})},handleSuccess(s){b.message("数据上传成功，将自动刷新页面！"),setTimeout(()=>{location.reload()},1e3)},handleError(s){b.message("数据上传失败"+s,"danger")},downloadFile(){const s="/GoNavModel.xlsx",e=document.createElement("a");e.href=s,e.download="GoNavModel.xlsx",e.click()},async downloadMyData(){try{this.loading=!0;const s=await A.downLoadApps({responseType:"blob"});console.log("下载文件响应：",s);const e=s.headers["content-type"];if(!e||e!=="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"){b.showAlert("服务器返回的不是有效的 Excel 文件。");return}this.downloadMyFile(s.data)}catch(s){console.error("文件下载出错：",s),b.showAlert("下载文件时发生错误，请稍后重试。")}finally{this.loading=!1}},downloadMyFile(s){const e=s instanceof Blob?s:new Blob([s],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),g=document.createElement("a");g.href=URL.createObjectURL(e),g.download="apps.xlsx",document.body.appendChild(g),g.click(),document.body.removeChild(g)}}},G={class:"row"},q={class:"col"},_=["disabled"],H={class:"col-auto"},J=["disabled"],K={class:"col-auto"},Q=["disabled"],W={class:"col-auto"},Y=["disabled"],Z={key:0,class:"overlay"};function $(s,e,g,t,c,m){return i(),r("div",G,[l("div",q,[l("input",{type:"file",onChange:e[0]||(e[0]=(...d)=>m.handleFileChange&&m.handleFileChange(...d)),accept:".xlsx",class:"form-control",disabled:c.loading},null,40,_),e[4]||(e[4]=l("small",{class:"form-text text-muted"},"上传xlsx文件",-1))]),l("div",H,[l("button",{class:"btn btn-success",onClick:e[1]||(e[1]=(...d)=>m.uploadFile&&m.uploadFile(...d)),disabled:!c.selectedFile||c.loading}," 上传数据 ",8,J)]),l("div",K,[l("button",{class:"btn btn-primary",onClick:e[2]||(e[2]=(...d)=>m.downloadFile&&m.downloadFile(...d)),disabled:c.loading}," 下载模板 ",8,Q)]),l("div",W,[l("button",{class:"btn btn-outline-secondary",onClick:e[3]||(e[3]=(...d)=>m.downloadMyData&&m.downloadMyData(...d)),disabled:c.loading}," 下载本人数据 ",8,Y)]),c.loading?(i(),r("div",Z,e[5]||(e[5]=[l("div",{class:"spinner-border",role:"status"},[l("span",{class:"visually-hidden"},"加载中...")],-1)]))):O("",!0)])}const ee=U(R,[["render",$],["__scopeId","data-v-88db60e3"]]),le={components:{UploadXlsx:ee},setup(){const s=D({id:null,name:"",description:"",url:"",iconUrl:"",weight:1,status:1,clickCount:0,categoryId:null}),e=D([]),g=D([]),t=async()=>{try{const n=await X.getCategoryList();console.log(n),g.value=n.data}catch(n){console.error(n)}};V(()=>{t()});let c=null;const m=D(1),d=D({pageNum:1,pageSize:10,categoryId:null,status:null,searchContent:null}),o=n=>{const S=document.getElementById(n);c=new z(S),c.show()},k=n=>{n<1||n>m.value||(d.value.pageNum=n,f())},a=()=>{d.value.pageNum=1,f()},P=async()=>{try{(await A.addApp(s.value)).code===0?(b.message("应用添加成功"),C(),c.hide(),f()):b.message("添加分类失败，请重试","danger")}catch(n){console.error(n)}},L=async()=>{try{(await A.deleteApp(s.value.id)).code===0?(b.message("应用删除成功"),C(),c.hide(),f()):b.message("删除分类失败，请重试","danger")}catch(n){console.error(n)}},M=async()=>{try{(await A.updateApp(s.value)).code===0?(b.message("应用修改成功"),C(),c.hide(),f()):b.message("修改分类失败，请重试","danger")}catch(n){console.error(n)}},f=async()=>{try{const n=await A.getAppPageList(d.value.pageNum,d.value.pageSize,d.value.categoryId,d.value.status,d.value.searchContent);console.log(n),e.value=n.data.items,console.log(e.value),m.value=parseInt(n.data.total/d.value.pageSize)+1}catch(n){console.error(n)}};f();const C=()=>{s.value={id:null,name:"",description:"",url:"",iconUrl:"",weight:1,status:1,clickCount:0,categoryId:null}};return{appDTO:s,openModal:o,submitApp:P,resetForm:C,getAppPageList:f,getAppPageListData:d,submitDeleteApp:L,submitUpdateApp:M,changePage:k,totalPages:m,changePageSize:a,appList:e,categoryNowList:g}}},te={class:"container mt-4",style:{margin:"0px"}},oe={class:"row"},se={class:"col"},ae={class:"mb-3 d-flex justify-content-end col"},ne=["value"],de={class:"modal fade",id:"addAppModal",tabindex:"-1","aria-labelledby":"addAppModalLabel","aria-hidden":"true"},ie={class:"modal-dialog"},re={class:"modal-content"},pe={class:"modal-body"},ce={class:"mb-3"},me={class:"mb-3"},ue=["value"],be={class:"mb-3"},ge={class:"mb-3"},ve={class:"mb-3"},fe={class:"mb-3"},ye={class:"table table-striped table-hover text-center"},he={scope:"row"},De=["src"],xe={key:0,class:"badge bg-success"},we={key:1,class:"badge bg-success"},Ae={key:2,class:"badge bg-success"},ke={key:3,class:"badge bg-danger"},Ce=["onClick"],Te={class:"modal-dialog"},Ue={class:"modal-content"},Oe={class:"modal-header"},Pe={class:"modal-body"},Le={class:"mb-3"},Me={class:"mb-3"},Se={class:"mb-3"},Fe={class:"mb-3"},Ne=["value"],Ve={class:"mb-3"},Ie={class:"mb-3"},ze={class:"mb-3"},Ee={class:"mb-3"},Be=["onClick"],Xe={class:"modal-dialog"},je={class:"modal-content"},Re={class:"modal-body"},Ge={"aria-label":"Page navigation"},qe={class:"pagination justify-content-center"},_e=["onClick"];function He(s,e,g,t,c,m){const d=E("UploadXlsx");return i(),r("div",te,[l("div",oe,[I(d),l("div",se,[l("button",{class:"btn btn-primary",onClick:e[0]||(e[0]=o=>t.openModal("addAppModal"))},"添加应用")]),l("div",ae,[e[30]||(e[30]=l("label",{for:"pageSizeSelect",class:"me-2",style:{"line-height":"38px"}},"选择分类:",-1)),p(l("select",{id:"pageSizeSelect",class:"form-select w-auto","onUpdate:modelValue":e[1]||(e[1]=o=>t.getAppPageListData.categoryId=o),onChange:e[2]||(e[2]=(...o)=>t.changePageSize&&t.changePageSize(...o))},[e[27]||(e[27]=l("option",{value:"",disabled:""},"请选择分类",-1)),e[28]||(e[28]=l("option",{value:""},"全部分类",-1)),(i(!0),r(x,null,w(t.categoryNowList,o=>(i(),r("option",{key:o.id,value:o.id},u(o.name),9,ne))),128))],544),[[y,t.getAppPageListData.categoryId]]),e[31]||(e[31]=l("label",{for:"pageSizeSelect",class:"me-2",style:{"line-height":"38px"}},"每页显示:",-1)),p(l("select",{id:"pageSizeSelect",class:"form-select w-auto","onUpdate:modelValue":e[3]||(e[3]=o=>t.getAppPageListData.pageSize=o),onChange:e[4]||(e[4]=(...o)=>t.changePageSize&&t.changePageSize(...o))},e[29]||(e[29]=[l("option",{value:"10"},"10",-1),l("option",{value:"20"},"20",-1),l("option",{value:"30"},"30",-1),l("option",{value:"50"},"50",-1)]),544),[[y,t.getAppPageListData.pageSize]])])]),l("div",de,[l("div",ie,[l("div",re,[e[41]||(e[41]=l("div",{class:"modal-header"},[l("h5",{class:"modal-title",id:"addAppModalLabel"},"添加应用"),l("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),l("div",pe,[l("form",{onSubmit:e[11]||(e[11]=h((...o)=>t.submitApp&&t.submitApp(...o),["prevent"]))},[l("div",ce,[e[32]||(e[32]=l("label",{for:"add-name",class:"form-label"},"名称",-1)),p(l("input",{"onUpdate:modelValue":e[5]||(e[5]=o=>t.appDTO.name=o),type:"text",class:"form-control",id:"add-name",placeholder:"输入APP名称（非必填）"},null,512),[[v,t.appDTO.name]])]),l("div",me,[e[34]||(e[34]=l("label",{for:"add-categoryId",class:"form-label"},"所属分类",-1)),p(l("select",{"onUpdate:modelValue":e[6]||(e[6]=o=>t.appDTO.categoryId=o),class:"form-select",id:"add-categoryId"},[e[33]||(e[33]=l("option",{value:"",disabled:""},"请选择分类",-1)),(i(!0),r(x,null,w(t.categoryNowList,o=>(i(),r("option",{key:o.id,value:o.id},u(o.name),9,ue))),128))],512),[[y,t.appDTO.categoryId]])]),l("div",be,[e[35]||(e[35]=l("label",{for:"add-url",class:"form-label"},"网址",-1)),p(l("input",{"onUpdate:modelValue":e[7]||(e[7]=o=>t.appDTO.url=o),type:"text",class:"form-control",id:"add-url",placeholder:"输入APP 网址"},null,512),[[v,t.appDTO.url]])]),l("div",ge,[e[36]||(e[36]=l("label",{for:"add-description",class:"form-label"},"描述",-1)),p(l("input",{"onUpdate:modelValue":e[8]||(e[8]=o=>t.appDTO.description=o),type:"text",class:"form-control",id:"add-description",placeholder:"输入APP描述（非必填）"},null,512),[[v,t.appDTO.description]])]),l("div",ve,[e[37]||(e[37]=l("label",{for:"add-weight",class:"form-label"},"权重",-1)),p(l("input",{"onUpdate:modelValue":e[9]||(e[9]=o=>t.appDTO.weight=o),type:"number",class:"form-control",id:"add-weight",placeholder:"输入权重"},null,512),[[v,t.appDTO.weight]])]),l("div",fe,[e[39]||(e[39]=l("label",{for:"add-status",class:"form-label"},"状态",-1)),p(l("select",{"onUpdate:modelValue":e[10]||(e[10]=o=>t.appDTO.status=o),class:"form-select",id:"add-status"},e[38]||(e[38]=[l("option",{value:"1"},"全部可见",-1),l("option",{value:"2"},"登录后可见",-1),l("option",{value:"3"},"本人可见",-1),l("option",{value:"4"},"隐藏",-1)]),512),[[y,t.appDTO.status]])]),e[40]||(e[40]=l("button",{type:"submit",class:"btn btn-primary",style:{float:"inline-end"}},"确认添加",-1))],32)])])])]),l("div",null,[l("table",ye,[e[56]||(e[56]=l("thead",null,[l("tr",null,[l("th",{scope:"col"},"#"),l("th",{scope:"col"},"名称"),l("th",{scope:"col"},"所属分类"),l("th",{scope:"col"},"图标"),l("th",{scope:"col"},"描述"),l("th",{scope:"col"},"URL"),l("th",{scope:"col"},"权重"),l("th",{scope:"col"},"状态"),l("th",{scope:"col"},"点击数"),l("th",{scope:"col"},"操作")])],-1)),l("tbody",null,[(i(!0),r(x,null,w(t.appList,(o,k)=>(i(),r("tr",null,[l("th",he,u(k+1),1),l("td",null,u(o.name),1),l("td",null,u(o.categoryName),1),l("td",null,[o.iconUrl!==""?(i(),r("img",{key:0,src:o.iconUrl,alt:"",class:"img-thumbnail",width:"40",height:"40"},null,8,De)):O("",!0)]),l("td",null,u(o.description.slice(0,10))+u(o.description.length>10?"...":""),1),l("td",null,u(o.url),1),l("td",null,u(o.weight),1),l("td",null,[o.status===1?(i(),r("span",xe,"公开")):o.status===2?(i(),r("span",we,"登录")):o.status===3?(i(),r("span",Ae,"私有")):(i(),r("span",ke,"隐藏"))]),l("td",null,u(o.clickCount),1),l("td",null,[l("button",{class:"btn btn-primary btn-sm",onClick:a=>{t.appDTO=o,t.openModal("updateAppModal")}},"编辑",8,Ce),l("div",{class:"modal fade text-start",id:"updateAppModal",tabindex:"-1","aria-labelledby":"updateAppModalLabel","aria-hidden":"true",onClick:e[22]||(e[22]=a=>t.getAppPageList())},[l("div",Te,[l("div",Ue,[l("div",Oe,[e[42]||(e[42]=l("h5",{class:"modal-title",id:"addCategoryModalLabel"},"编辑应用",-1)),l("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:e[12]||(e[12]=a=>s.categoryDTO=s.origincategoryDTO)})]),l("div",Pe,[l("form",{onSubmit:e[21]||(e[21]=h((...a)=>t.submitUpdateApp&&t.submitUpdateApp(...a),["prevent"]))},[l("div",Le,[e[43]||(e[43]=l("label",{for:"name",class:"form-label"},"应用名称",-1)),p(l("input",{"onUpdate:modelValue":e[13]||(e[13]=a=>t.appDTO.name=a),type:"text",class:"form-control",id:"name",placeholder:"输入应用名称"},null,512),[[v,t.appDTO.name]])]),l("div",Me,[e[44]||(e[44]=l("label",{for:"url",class:"form-label"},"应用地址",-1)),p(l("input",{"onUpdate:modelValue":e[14]||(e[14]=a=>t.appDTO.url=a),type:"text",class:"form-control",id:"url",placeholder:"输入应用地址"},null,512),[[v,t.appDTO.url]])]),l("div",Se,[e[45]||(e[45]=l("label",{for:"iconUrl",class:"form-label"},"图标",-1)),p(l("input",{"onUpdate:modelValue":e[15]||(e[15]=a=>t.appDTO.iconUrl=a),type:"text",class:"form-control",id:"iconUrl",placeholder:"输入图标地址"},null,512),[[v,t.appDTO.iconUrl]])]),l("div",Fe,[e[47]||(e[47]=l("label",{for:"categoryId",class:"form-label"},"分类",-1)),p(l("select",{"onUpdate:modelValue":e[16]||(e[16]=a=>t.appDTO.categoryId=a),class:"form-select",id:"categoryId"},[e[46]||(e[46]=l("option",{value:"",disabled:""},"请选择分类",-1)),(i(!0),r(x,null,w(t.categoryNowList,a=>(i(),r("option",{key:a.id,value:a.id},u(a.name),9,Ne))),128))],512),[[y,t.appDTO.categoryId]])]),l("div",Ve,[e[48]||(e[48]=l("label",{for:"description",class:"form-label"},"描述",-1)),p(l("input",{"onUpdate:modelValue":e[17]||(e[17]=a=>t.appDTO.description=a),type:"text",class:"form-control",id:"description",placeholder:"输入应用描述信息"},null,512),[[v,t.appDTO.description]])]),l("div",Ie,[e[49]||(e[49]=l("label",{for:"weight",class:"form-label"},"权重",-1)),p(l("input",{"onUpdate:modelValue":e[18]||(e[18]=a=>t.appDTO.weight=a),type:"number",class:"form-control",id:"weight",placeholder:"输入权重"},null,512),[[v,t.appDTO.weight]])]),l("div",ze,[e[50]||(e[50]=l("label",{for:"weight",class:"form-label"},"点击数",-1)),p(l("input",{"onUpdate:modelValue":e[19]||(e[19]=a=>t.appDTO.clickCount=a),type:"number",class:"form-control",id:"clickCount",placeholder:"输入点击数",readonly:""},null,512),[[v,t.appDTO.clickCount]])]),l("div",Ee,[e[52]||(e[52]=l("label",{for:"status",class:"form-label"},"状态",-1)),p(l("select",{"onUpdate:modelValue":e[20]||(e[20]=a=>t.appDTO.status=a),class:"form-select",id:"status"},e[51]||(e[51]=[l("option",{value:"1"},"全部可见",-1),l("option",{value:"2"},"登陆后可见",-1),l("option",{value:"3"},"本人可见",-1),l("option",{value:"4"},"隐藏",-1)]),512),[[y,t.appDTO.status]])]),e[53]||(e[53]=l("button",{type:"submit",class:"btn btn-primary"},"确认修改",-1))],32)])])])]),l("button",{class:"btn btn-danger btn-sm",onClick:a=>{t.appDTO=o,t.openModal("deleteAppModal")},style:{"margin-left":"5px"}},"删除",8,Be),l("div",{class:"modal fade text-start",id:"deleteAppModal",tabindex:"-1","aria-labelledby":"deleteAppModalLabel","aria-hidden":"true",onClick:e[24]||(e[24]=a=>t.getAppPageList())},[l("div",Xe,[l("div",je,[e[55]||(e[55]=l("div",{class:"modal-header"},[l("h5",{class:"modal-title",id:"deleteAppModalLabel"},"删除分类"),l("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),l("div",Re,[B(" 确认删除应用"+u(t.appDTO.name)+"？ ",1),l("form",{onSubmit:e[23]||(e[23]=h((...a)=>t.submitDeleteApp&&t.submitDeleteApp(...a),["prevent"]))},e[54]||(e[54]=[l("button",{type:"submit",class:"btn btn-primary",style:{float:"inline-end"}},"确认删除",-1)]),32)])])])])])]))),256))])]),l("nav",Ge,[l("ul",qe,[l("li",{class:T(["page-item",{disabled:t.getAppPageListData.pageNum===1}])},[l("a",{class:"page-link",href:"#",onClick:e[25]||(e[25]=h(o=>t.changePage(t.getAppPageListData.pageNum-1),["prevent"]))},"上一页")],2),(i(!0),r(x,null,w(t.totalPages,o=>(i(),r("li",{class:T(["page-item",{active:o===t.getAppPageListData.pageNum}]),key:o},[l("a",{class:"page-link",href:"#",onClick:h(k=>t.changePage(o),["prevent"])},u(o),9,_e)],2))),128)),l("li",{class:T(["page-item",{disabled:t.getAppPageListData.pageNum===t.totalPages}])},[l("a",{class:"page-link",href:"#",onClick:e[26]||(e[26]=h(o=>t.changePage(t.getAppPageListData.pageNum+1),["prevent"]))},"下一页")],2)])])])])}const We=U(le,[["render",He],["__scopeId","data-v-27564d88"]]);export{We as default};
